---
phase: 01-test-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .golangci.yml
autonomous: true

must_haves:
  truths:
    - "golangci-lint runs without configuration errors"
    - "All recommended linters are enabled (staticcheck, errcheck, govet, gosec, etc.)"
    - "Linter configuration enforces strict error checking (no unchecked errors allowed)"
    - "Style linters enforce import grouping and naming conventions"
  artifacts:
    - path: ".golangci.yml"
      provides: "Linter configuration with strict settings"
      contains: "errcheck"
    - path: ".golangci.yml"
      provides: "Complexity limits"
      contains: "gocognit"
  key_links:
    - from: ".github/workflows/ci.yml"
      to: ".golangci.yml"
      via: "golangci-lint-action reads config automatically"
      pattern: "golangci-lint"
---

<objective>
Create strict golangci-lint configuration for comprehensive static analysis

Purpose: Establish linting foundation that catches bugs, security issues, and code quality problems before merge. The configuration enforces errcheck (unchecked errors), gosec (security), staticcheck (bugs), and complexity limits. This is INFRA-02 from the roadmap.

Output: A `.golangci.yml` file that golangci-lint uses automatically in both local development and CI.
</objective>

<execution_context>
@/home/overlordyorch/.claude/get-shit-done/workflows/execute-plan.md
@/home/overlordyorch/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-test-foundation/01-CONTEXT.md
@.planning/phases/01-test-foundation/01-RESEARCH.md
@Makefile
@.github/workflows/ci.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create golangci-lint configuration</name>
  <files>.golangci.yml</files>
  <action>
Create `.golangci.yml` with the following strict configuration based on research:

```yaml
# Strict golangci-lint configuration for pocket-relay-miner
# Based on community golden config: https://gist.github.com/maratori/47a4d00457a92aa426dbd48a18776322
run:
  timeout: 5m
  tests: true
  modules-download-mode: readonly

linters:
  enable:
    # Error handling (CRITICAL - per CLAUDE.md error handling requirements)
    - errcheck          # Unchecked errors
    - errorlint         # Error wrapping

    # Security
    - gosec             # Security problems

    # Code quality
    - staticcheck       # Go vet++
    - govet             # Official Go checker
    - ineffassign       # Unused assignments
    - unused            # Unused code

    # Complexity
    - gocognit          # Cognitive complexity
    - gocyclo           # Cyclomatic complexity
    - funlen            # Function length

    # Style (enforces beyond gofmt)
    - goimports         # Import grouping
    - whitespace        # Extra whitespace

linters-settings:
  errcheck:
    check-blank: true           # error assignment to blank identifier
    check-type-assertions: true # unchecked type assertions

  gocognit:
    min-complexity: 30          # Cognitive complexity threshold (relaxed for existing code)

  gocyclo:
    min-complexity: 40          # Cyclomatic complexity threshold (relaxed for existing code)

  funlen:
    lines: 150                  # Max function lines (relaxed for existing large functions)
    statements: 80              # Max statements per function

issues:
  exclude-use-default: false    # No default exclusions
  max-issues-per-linter: 0      # Report all issues
  max-same-issues: 0            # Report all duplicates
```

Key decisions per 01-CONTEXT.md:
- Strict errcheck with check-blank and check-type-assertions
- All recommended linters enabled
- Complexity thresholds relaxed to accommodate existing large files (lifecycle_callback: 1898 lines, session_lifecycle: 1207 lines, proxy: 1842 lines) - these will be addressed in Phase 4
- No baseline approach - all code must pass
  </action>
  <verify>
Run `golangci-lint run --config .golangci.yml` from project root. Command should complete without configuration errors (lint violations are expected and acceptable at this stage).
  </verify>
  <done>
`.golangci.yml` file exists with all required linters enabled. Configuration is valid and can be parsed by golangci-lint.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify linter configuration works</name>
  <files>.golangci.yml</files>
  <action>
Run golangci-lint with the new configuration and verify:
1. Configuration parses without errors
2. Linters are actually running (not silently disabled)
3. Document the current violation count for reference

If configuration errors occur, fix them. If the violation count is extremely high (>100), consider adjusting thresholds slightly, but do NOT disable linters - the goal is strict enforcement.

The current CI already runs golangci-lint with v2.6, so the config will be automatically picked up on next PR.
  </action>
  <verify>
`golangci-lint run --config .golangci.yml 2>&1 | head -50` shows linter output (violations or clean pass), not configuration errors. The command should NOT fail with "unknown linter" or "config error" messages.
  </verify>
  <done>
Linter configuration is valid. Violation count is documented. No configuration errors prevent lint from running.
  </done>
</task>

</tasks>

<verification>
1. File `.golangci.yml` exists in project root
2. `golangci-lint run --config .golangci.yml` runs without configuration errors
3. All required linters are enabled: errcheck, errorlint, gosec, staticcheck, govet, ineffassign, unused, gocognit, gocyclo, funlen, goimports, whitespace
4. errcheck settings include check-blank: true and check-type-assertions: true
</verification>

<success_criteria>
- `.golangci.yml` file committed to repository
- Configuration is valid (no parse errors)
- Linter runs locally with the new config
- CI will automatically use the config on next PR (no CI changes needed for this plan)
</success_criteria>

<output>
After completion, create `.planning/phases/01-test-foundation/01-01-SUMMARY.md`
</output>
